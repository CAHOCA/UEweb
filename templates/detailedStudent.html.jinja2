{% extends "layout.html.jinja2" %}
{% block body %}
<div class="container p-3">

<h1 class="text-dark"><strong>Détails</strong></h1>
<nav aria-label="breadcrumb" class="main-breadcrumb mx-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="./">Home</a></li>
        <li class="breadcrumb-item"><a href="javascript:void(0)">Détails de l'utilisateur</a></li>
    </ol>
</nav>

<div class="row">
    <div class="col-md-4 pt-3 text-center">
        <img src="https://i.pravatar.cc/800" style="border-radius:50%; width:250px; weight:250px;" class="img-fluid">
        <h1 class="mt-3"><strong>{{student.first_name}} {{student.name}}</strong> </h1>
        <h4 class="text-primary">{{student.occupation}}</h4>
    </div>
    <div class="card col-md-8 p-3" style="border: none; border-radius: 15px;">
        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-start border border-0">
            
                <div class="ms-2 me-auto">
                    <div class="fw-bold">{{ student.first_name }} {{ student.name }}</div>
                    Promo : {{ promo.annee }}
                </div>
            
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-start border border-0">
            
                Taf 1 : {{ taf1.name }}
            
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-start border border-0">

                Taf 2 : {{ taf2.name }}

            </li>
            <li class="list-group-item d-flex justify-content-between align-items-start border border-0">

                Intitulé de Stage: {{ stage.title }}

            </li>
            <li class="list-group-item d-flex justify-content-between align-items-start border border-0">

                Résumé : {{ stage.resume }}

            </li>
            <li class="list-group-item d-flex justify-content-between align-items-start border border-0">

                {% for occupation in occupations %}
                    {%  if occupation.active==1 %}
                     <div id="occupation-{{ occupation.id }}">
                        <p style="font-weight: bold">{{ occupation.title }}</p>
                        <p>{{ occupation.start_date.strftime('%d-%m-%Y') }}<p>
                        <button onclick="deleteOccupation({{ occupation.id }})"> Delete </button>
                    </div>
                    {%  else %}
                        <div id="occupation-{{ occupation.id }}">
                            <p>{{ occupation.title }}</p>
                        <p>{{ occupation.start_date.strftime('%d-%m-%Y') }}<p>
                        <button onclick="deleteOccupation({{ occupation.id }})"> Delete </button>
                    </div>
                    {%  endif %}
                {% endfor %}

            </li>
        </ul>
    </div>
</div>


</div>
<script>
    function deleteOccupation(id) {
        console.log(id);
        let el = document.getElementById(`occupation-${id}`);
        let xhr = new XMLHttpRequest();
        let url = "../../delete/occupation";
        xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/json");

        // Create a state change callback
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
            }
        };
        var data = JSON.stringify({ "id": id});
        xhr.send(data);
        el.classList.add("hidden");
    }
</script>
{% endblock %}